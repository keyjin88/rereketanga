# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Invalid stops" –≤ DivergenceTrader EA

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ –≤ —Ç–µ—Å—Ç–µ—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏:
```
failed market buy 0.1 EURUSD sl: 1.12512 tp: 1.13222 [Invalid stops]
CTrade::OrderSend: market buy 0.10 EURUSD sl: 1.12512 tp: 1.13222 [invalid stops]
‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: 10016 - invalid stops
```

## üîç –ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –ø–∏–∫–∞ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–µ–π** - —Å–æ–≤–µ—Ç–Ω–∏–∫ –ø—ã—Ç–∞–ª—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–æ —Ü–µ–Ω–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –ø–∏–∫–∞
2. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–π –±—Ä–æ–∫–µ—Ä–∞** - –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `SYMBOL_TRADE_STOPS_LEVEL`
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** - TP/SL –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–æ—á–Ω–æ—Å—Ç–∏
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - —É—Ä–æ–≤–Ω–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –æ—Ä–¥–µ—Ä–∞

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç TP/SL
**–ë—ã–ª–æ:**
```mql5
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ü–µ–Ω–∞ –ø–∏–∫–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
signal.entry_price = recent_peak.price;
signal.tp_price = signal.entry_price + tp_distance;
```

**–°—Ç–∞–ª–æ:**
```mql5
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–ï–ö–£–©–ê–Ø —Ä—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞
double current_price = signal.is_bearish ? current_bid : current_ask;
signal.entry_price = current_price;
signal.tp_price = current_price + tp_distance;
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
```mql5
// –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±—Ä–æ–∫–µ—Ä–∞
int stops_level = (int)SymbolInfoInteger(_Symbol, SYMBOL_TRADE_STOPS_LEVEL);
double min_distance = stops_level * g_point * MinStopDistanceMultiplier;

// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
tp_distance = MathMax(tp_distance, min_distance);
sl_distance = MathMax(sl_distance, min_distance);
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π
```mql5
bool ValidateTPSL(double price, double tp, double sl, bool is_buy)
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–¥–ª—è BUY: SL –Ω–∏–∂–µ, TP –≤—ã—à–µ)
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º false –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
}
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```mql5
UseFixedTPSL = true              // –í–∫–ª—é—á–µ–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TP/SL
FixedTPPoints = 800             // –£–≤–µ–ª–∏—á–µ–Ω TP (–±—ã–ª–æ 500)
FixedSLPoints = 400             // –£–≤–µ–ª–∏—á–µ–Ω SL (–±—ã–ª–æ 250)
MinStopDistanceMultiplier = 2.0 // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

## üîß –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- **`MinStopDistanceMultiplier`** - –º–Ω–æ–∂–∏—Ç–µ–ª—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2.0)
- **`UseFixedTPSL = true`** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TP/SL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –£–≤–µ–ª–∏—á–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è `FixedTPPoints` –∏ `FixedSLPoints`

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
```
üîÑ –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏: BUY | –¶–µ–Ω–∞: 1.12800 | SL: 1.12400 | TP: 1.13600
–û–¢–õ–ê–î–ö–ê TP/SL: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 1.12800 | TP: 1.13600 | SL: 1.12400 | –ú–∏–Ω.–¥–∏—Å—Ç–∞–Ω—Ü–∏—è: 0.00100
```

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:
```
‚ùå SL —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –¥–ª—è BUY: 0.00050 < 0.00100
üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: Bid=1.12795 Ask=1.12805 –°–ø—Ä–µ–¥=0.00010
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Invalid stops"
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç TP/SL –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±—Ä–æ–∫–µ—Ä–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–¢–µ–ø–µ—Ä—å —Å–æ–≤–µ—Ç–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –±–µ–∑ –æ—à–∏–±–æ–∫!** üöÄ 